# 📍 空间预订开票流程说明

## 功能概述

客户预订空间后，可以一键开具发票收款，自动关联预订信息，自动更新付款状态。

---

## 🎯 完整功能列表

### ✅ 已实现功能

1. **空间管理** - 管理4个空间（半亩天光讲堂、半亩天光阅读区、半亩天光、T&N）
2. **空间预订** - 客户预订空间，设置时间、费用
3. **一键开票** - 从预订直接跳转开票
4. **自动填充** - 客户、租金自动填入发票
5. **自动同步** - 开票后自动更新预订付款状态
6. **活动关联** - 活动管理可选择空间地点
7. **日历视图** - 仪表盘显示所有业务事件

---

## 🚀 完整使用流程

### 步骤1：添加空间（一次性设置）

**路径：** 业务管理 → 空间管理

```
添加以下4个空间：

1. 半亩天光讲堂
   - 类型: 教室
   - 容纳: 50人
   - 面积: 80㎡
   - 楼层: 1楼
   - 设施: 投影仪, 白板, 音响, 讲台
   - 时租: RM50/小时
   - 日租: RM350/天
   - 月租: RM8000/月
   - 状态: 可用

2. 半亩天光阅读区
   - 类型: 自习室
   - 容纳: 30人
   - 面积: 60㎡
   - 楼层: 2楼
   - 设施: 阅读灯, 书桌, 椅子, 书架
   - 时租: RM30/小时
   - 日租: RM200/天
   - 月租: RM5000/月
   - 状态: 可用

3. 半亩天光
   - 类型: 活动空间
   - 容纳: 100人
   - 面积: 150㎡
   - 楼层: 1楼
   - 设施: 投影仪, 音响, 舞台, 灯光
   - 时租: RM80/小时
   - 日租: RM500/天
   - 月租: RM12000/月
   - 状态: 可用

4. T&N
   - 类型: 会议室
   - 容纳: 20人
   - 面积: 40㎡
   - 楼层: 2楼
   - 设施: 会议桌, 投影仪, 白板
   - 时租: RM40/小时
   - 日租: RM280/天
   - 月租: RM6000/月
   - 状态: 可用
```

---

### 步骤2：客户预订空间

**路径：** 业务管理 → 空间预订

#### 2.1 创建预订

```
点击"新建预订"

选择空间 *
[半亩天光讲堂 - 50人 - 时租RM50.00 ▼]

客户 *
[选择已有客户 ▼] 或点击"快速添加"添加新客户

开始日期 * : [2024-10-20]
开始时间 * : [14:00]

计费方式 *
[按小时 ▼]
  - 按小时
  - 按天
  - 按月

时长 * : [3] 小时数

┌─────────────────────────────────────┐
│ 结束时间: 2024-10-20 17:00          │
│ 租金总额: RM150.00                  │
└─────────────────────────────────────┘

押金: [50.00]

使用目的: [国学讲座]
预计人数: [40]
特殊要求: [需要准备茶水]

点击"确认预订"
```

#### 2.2 预订成功提示

```
✅ 预订成功！
预订号：BK202410-001
总金额：RM150.00
已付押金：RM50.00
```

---

### 步骤3：查看预订列表

**路径：** 业务管理 → 空间预订

**预订列表显示：**

```
┌────────────────────────────────────────────────────────────────┐
│ 空间预订                                    [新建预订]         │
├────────────────────────────────────────────────────────────────┤
│ 状态: [全部 ▼]  共 1 条预订                                    │
├────────────────────────────────────────────────────────────────┤
│ 预订号      │空间         │客户   │使用时间        │费用    │状态    │操作│
│─────────────┼─────────────┼───────┼────────────────┼────────┼────────┼────│
│ BK202410-001│半亩天光讲堂 │张三   │2024-10-20 14:00│RM150.00│[已确认]│👁️📄│
│             │             │012-XXX│至 10-20 17:00  │欠RM100 │        │    │
└────────────────────────────────────────────────────────────────┘
                                                                      ↑
                                                            开发票按钮
```

---

### 步骤4：查看预订详情

**点击 👁️ 查看详情**

```
┌─────────────────────────────────────────────────────────┐
│ 预订详情                                            ✕   │
├─────────────────────────────────────────────────────────┤
│ 预订号: BK202410-001          状态: [已确认]            │
│ 空间: 半亩天光讲堂            客户: 张三                 │
│                               012-1111111               │
│                                                         │
│ 开始时间: 2024-10-20 14:00                              │
│ 结束时间: 2024-10-20 17:00                              │
│                                                         │
│ 计费方式: 按小时 × 3          单价: RM50.00             │
│                                                         │
│ 使用目的: 国学讲座                                      │
│ 预计人数: 40人                                          │
│ 特殊要求: 需要准备茶水                                  │
│                                                         │
│ ┌───────────────────────────────────────┐             │
│ │ 租金总额        RM150.00               │             │
│ │ 押金            RM50.00                │             │
│ │ 已付金额        RM50.00                │             │
│ │ ─────────────────────────────         │             │
│ │ 未付金额        RM100.00               │             │
│ └───────────────────────────────────────┘             │
│                                                         │
│ [📄 开发票收款]                            [关闭]      │
└─────────────────────────────────────────────────────────┘
```

---

### 步骤5：点击"开发票收款" 🎯

**点击后自动跳转到开单页面，并自动填充！**

```
跳转到：开单管理

自动填充内容：
✅ 客户: 张三（已选中）
✅ 商品明细:
   ┌────────────────────────────────────────────┐
   │ 商品名称              │数量│单价   │金额   │
   │───────────────────────┼────┼───────┼───────│
   │ 空间租赁 - 半亩天光讲堂│ 1  │RM100.00│RM100.00│
   └────────────────────────────────────────────┘

✅ 备注自动填入:
   空间预订号：BK202410-001
   使用时间：2024-10-20 14:00 至 10-20 17:00

✅ 金额: RM100.00（未付金额，不包括已付押金）

您只需要：
1. 选择付款方式
2. 输入开单人
3. 点击"提交"
```

---

### 步骤6：完成开票

```
立即付款: [是]
付款金额: [100.00]（预填未付金额）
付款方式: [现金 ▼]
开单人: [小李]

点击"提交"

系统自动执行：
✅ 创建发票（INV202410-XXX）
✅ 记录收款 RM100.00
✅ 自动更新空间预订:
   - 已付金额: RM50 → RM150
   - 未付金额: RM100 → RM0
   - 状态: 已确认 → 已完成 ✅

成功提示：
┌────────────────────────────────┐
│ 发票创建成功！                 │
│ 发票号：INV202410-025          │
│                                │
│ 全款已付                       │
└────────────────────────────────┘
```

---

## 💡 使用场景示例

### 场景1：时租（按小时）

```
客户需求：
- 租用T&N会议室
- 开会2小时
- 下午3点到5点

预订设置：
- 空间: T&N
- 日期: 2024-10-25
- 时间: 15:00
- 计费: 按小时
- 时长: 2小时
- 费用: RM40 × 2 = RM80
- 押金: RM30

预订状态：
已付押金RM30，还欠RM50

开发票：
点击"开发票收款"
→ 自动创建发票，金额RM50
→ 客户付款RM50
→ 预订完成 ✅
```

### 场景2：日租（按天）

```
客户需求：
- 租用半亩天光讲堂
- 举办全天活动
- 10月28日

预订设置：
- 空间: 半亩天光讲堂
- 日期: 2024-10-28
- 时间: 09:00
- 计费: 按天
- 时长: 1天
- 费用: RM350
- 押金: RM100

预订状态：
已付押金RM100，还欠RM250

开发票：
点击"开发票收款"
→ 自动创建发票，金额RM250
→ 客户付款RM250
→ 预订完成 ✅
```

### 场景3：月租（按月）

```
客户需求：
- 长期租用半亩天光阅读区
- 3个月
- 11月1日开始

预订设置：
- 空间: 半亩天光阅读区
- 日期: 2024-11-01
- 时间: 00:00
- 计费: 按月
- 时长: 3月
- 费用: RM5000 × 3 = RM15000
- 押金: RM2000

预订状态：
已付押金RM2000，还欠RM13000

开发票方式1：
全额收款
→ 开发票RM13000
→ 客户付款RM13000
→ 预订完成

开发票方式2：
分期收款
→ 第一个月开票RM5000
→ 第二个月开票RM5000
→ 第三个月开票RM3000
→ 预订逐步完成
```

---

## 🎨 界面展示

### 空间预订列表

```
┌──────────────────────────────────────────────────────────────────┐
│ 📍 空间预订                                    [新建预订]        │
│ 管理空间租赁和预订                                               │
├──────────────────────────────────────────────────────────────────┤
│ 状态: [全部 ▼]  共 3 条预订                                      │
├──────────────────────────────────────────────────────────────────┤
│ 预订号       │空间          │客户    │使用时间       │费用      │状态    │操作│
│──────────────┼──────────────┼────────┼───────────────┼──────────┼────────┼────│
│ BK202410-001 │半亩天光讲堂  │张三    │10-20 14:00    │RM150.00  │[已确认]│👁️📄│
│              │              │012-XXX │至 10-20 17:00 │欠RM100   │        │    │
│──────────────┼──────────────┼────────┼───────────────┼──────────┼────────┼────│
│ BK202410-002 │T&N           │李四    │10-25 15:00    │RM80.00   │[已完成]│👁️  │
│              │              │013-XXX │至 10-25 17:00 │已付清    │        │    │
│──────────────┼──────────────┼────────┼───────────────┼──────────┼────────┼────│
│ BK202410-003 │半亩天光      │王五    │10-30 09:00    │RM500.00  │[已确认]│👁️📄│
│              │              │014-XXX │至 10-30 18:00 │欠RM350   │        │    │
└──────────────────────────────────────────────────────────────────┘

图标说明：
👁️ = 查看详情
📄 = 开发票（只在有未付金额时显示）
```

### 点击"开发票"后的界面

```
自动跳转到：开单管理

┌──────────────────────────────────────────────────────────────────┐
│ 新建发票                                                     ✕   │
├──────────────────────────────────────────────────────────────────┤
│ 客户 *                                                           │
│ [张三 - 012-1111111 ▼]  ← 自动选中                              │
│                                                                  │
│ 商品明细                                                         │
│ ┌────────────────────────────────────────────────────────┐     │
│ │ 商品                      │数量│单价     │折扣│金额    │删除│ │
│ │──────────────────────────┼────┼─────────┼────┼────────┼────│ │
│ │ 空间租赁 - 半亩天光讲堂   │ 1  │RM100.00 │ 0% │RM100.00│ ✕ │ │
│ └────────────────────────────────────────────────────────┘     │
│                         ← 自动添加                              │
│                                                                  │
│ 小计: RM100.00                                                   │
│ 折扣: RM0.00                                                     │
│ 邮费: RM0.00                                                     │
│ 其他费用: RM0.00                                                 │
│ ─────────────────                                               │
│ 总计: RM100.00                                                   │
│                                                                  │
│ 备注                                                             │
│ ┌────────────────────────────────────────────┐                 │
│ │ 空间预订号：BK202410-001                    │ ← 自动填入     │
│ │ 使用时间：2024-10-20 14:00 至 10-20 17:00  │                 │
│ └────────────────────────────────────────────┘                 │
│                                                                  │
│ 立即付款: ⭕ 是  ⚪ 否                                           │
│ 付款金额: [100.00]  ← 预填未付金额                              │
│ 付款方式: [现金 ▼]                                               │
│                                                                  │
│ 开单人 *: [小李]                                                 │
│                                                                  │
│                                    [取消]  [提交]                │
└──────────────────────────────────────────────────────────────────┘
```

---

## 🔄 数据自动同步

### 开票后的自动更新

```
提交发票后，系统自动：

1. 创建发票
   ✅ 发票号: INV202410-025
   ✅ 客户: 张三
   ✅ 金额: RM100.00
   ✅ 已付: RM100.00

2. 更新空间预订
   ✅ 预订号: BK202410-001
   ✅ 已付金额: RM50 → RM150
   ✅ 未付金额: RM100 → RM0
   ✅ 状态: 已确认 → 已完成

3. 记录操作日志
   ✅ 创建发票记录
   ✅ 更新预订记录

数据追溯：
发票备注中有预订号 → 可追溯到原预订
预订记录 → 可查看付款发票
```

---

## 📊 日历视图集成

### 仪表板日历显示

**路径：** 仪表盘（首页）→ 向下滚动到"业务日历"

```
┌────────────────────────────────────────────────────────┐
│ 📅 业务日历            2024年 10月    [今天] [◀] [▶]  │
├────────────────────────────────────────────────────────┤
│  日   一   二   三   四   五   六                       │
├────────────────────────────────────────────────────────┤
│                          ┌──────┐                      │
│ ... ... ... ... ...  ... │  20  │ ...                 │
│                          │📅1活动│                      │
│                          │📍1预订│  ← 空间预订         │
│                          │💰RM150│  ← 包含租金         │
│                          └──────┘                      │
└────────────────────────────────────────────────────────┘

点击10月20日，下方显示：
┌────────────────────────────────────────────────────────┐
│ 2024年10月20日 星期日                                   │
├────────────────────────────────────────────────────────┤
│ 活动 (1)                                               │
│ ┌────────────────────────────────────────┐            │
│ │ 国学讲座 · 📍 半亩天光讲堂              │            │
│ └────────────────────────────────────────┘            │
│                                                        │
│ 空间预订 (1)                                           │
│ ┌────────────────────────────────────────┐            │
│ │ 半亩天光讲堂 · 张三 · RM150.00          │            │
│ └────────────────────────────────────────┘            │
│                                                        │
│ 销售 (2笔)                                             │
│ ┌────────────────────────────────────────┐            │
│ │ 收入: RM100.00                          │            │
│ └────────────────────────────────────────┘            │
│                                                        │
│ ────────────────────────────────────────              │
│ 当日总收入           RM250.00                          │
│ (包含：空间租金RM150 + 销售RM100)                      │
└────────────────────────────────────────────────────────┘
```

---

## 🎯 两种收款方式对比

### 方式1：预订时全额收款

```
创建预订时：
- 押金: RM150（全额）
- 已付: RM150
- 未付: RM0
- 状态: 已完成

优点：
✅ 一次性完成
✅ 不需要后续开票
✅ 适合小额租赁

缺点：
❌ 没有正式发票
```

### 方式2：预订+开票（推荐）⭐

```
创建预订时：
- 押金: RM50（部分）
- 已付: RM50
- 未付: RM100
- 状态: 已确认

使用后开票：
- 点击"开发票收款"
- 自动创建发票RM100
- 客户付款
- 状态: 已完成

优点：
✅ 有正式发票
✅ 财务记录完整
✅ 便于对账
✅ 适合大额租赁

适用场景：
✅ 企业客户（需要发票报销）
✅ 大额租赁
✅ 长期租赁
```

---

## 📋 完整业务流程

### 标准流程

```
Step 1: 客户咨询
   ↓
Step 2: 创建空间预订
   - 选择空间
   - 确定时间
   - 收取押金
   ↓
Step 3: 客户使用空间
   - 按预定时间使用
   ↓
Step 4: 开发票收款
   - 点击"开发票收款"
   - 自动跳转开单页面
   - 信息已预填
   - 收取剩余费用
   ↓
Step 5: 预订完成
   - 状态变为"已完成"
   - 记录到日历
   - 财务数据完整
```

---

## 🌟 功能亮点

### 1. 一键开票 ⭐
- 从预订直接跳转开单
- 无需重复录入信息
- 节省80%的时间

### 2. 自动填充 ⭐
- 客户自动选中
- 租金自动计算
- 时间自动备注

### 3. 自动同步 ⭐
- 开票后预订状态自动更新
- 付款金额自动累加
- 数据完全一致

### 4. 完整追溯 ⭐
- 发票备注含预订号
- 可追溯原始预订
- 审计记录完整

---

## ✅ 立即体验

### 完整测试流程（5分钟）

#### 1. 添加空间（1分钟）
```
业务管理 → 空间管理
→ 添加"半亩天光讲堂"
→ 设置租金：时租RM50
```

#### 2. 创建预订（1分钟）
```
业务管理 → 空间预订
→ 新建预订
→ 选择空间："半亩天光讲堂"
→ 选择客户（或快速添加）
→ 按小时，3小时
→ 押金RM50
→ 提交
```

#### 3. 开发票（1分钟）
```
在预订列表
→ 点击 📄 开发票按钮
→ 自动跳转到开单页面
→ 信息已自动填充
→ 只需选择付款方式和开单人
→ 提交
```

#### 4. 查看结果（1分钟）
```
返回空间预订
→ 看到预订状态变为"已完成"
→ 未付金额变为RM0

查看发票列表
→ 看到刚才的发票

查看仪表盘日历
→ 看到预订日期有 📍 标记
→ 点击查看详情
```

---

## 🔄 现在刷新浏览器！

**重要：** 需要刷新页面看到新功能！

```
按 Cmd+Shift+R (Mac) 或 Ctrl+Shift+R (Windows)
```

**刷新后您会看到：**

1. ✅ **业务管理 → 空间预订**（新菜单）
2. ✅ **活动管理** - 地点可选择空间
3. ✅ **仪表盘** - 底部有业务日历

---

## 📝 总结

**空间租赁全流程已完成：**

| 功能 | 状态 |
|------|------|
| 空间管理 | ✅ |
| 空间预订 | ✅ |
| 一键开票 | ✅ |
| 自动填充 | ✅ |
| 自动同步 | ✅ |
| 活动关联空间 | ✅ |
| 日历视图 | ✅ |

**业务价值：**
- 🎯 简化操作流程
- 🎯 提高工作效率
- 🎯 数据自动同步
- 🎯 财务记录完整

**空间租赁+开票，一气呵成！** 📍💰✨

