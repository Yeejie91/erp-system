# 💰 应收应付账款管理系统说明

## 功能概述

完整的应收账款和应付账款管理系统，帮助您追踪客户欠款和供应商付款，确保资金流管理清晰。

---

## 🎯 核心功能

### 1. 应收账款管理（客户欠款）
- 查看所有客户欠款
- 记录收款
- 逾期提醒
- 账龄分析

### 2. 应付账款管理（供应商欠款）
- 查看所有供应商欠款
- 记录付款
- 逾期提醒
- 付款计划

---

## 📋 账款状态

### 状态类型

| 状态 | 英文 | 颜色 | 说明 |
|------|------|------|------|
| 未收款/未付款 | pending | 黄色 | 还没有收款/付款记录 |
| 部分收款/部分付款 | partial | 蓝色 | 已收/付部分金额 |
| 已收清/已付清 | paid | 绿色 | 全部金额已收/付完 |
| 已逾期 | overdue | 红色 | 超过到期日仍未付清 |

### 状态自动更新

**系统会自动根据以下条件更新状态：**

```
如果 剩余金额 = 0
  → 状态 = 已收清/已付清

如果 剩余金额 < 总金额
  → 状态 = 部分收款/部分付款

如果 到期日 < 今天 且 剩余金额 > 0
  → 状态 = 已逾期

否则
  → 状态 = 未收款/未付款
```

---

## 💵 应收账款管理

### 页面路径
**业务管理 → 应收账款**

### 统计卡片

```
┌─────────────────┬─────────────────┬─────────────────┐
│ 应收总额        │ 逾期金额        │ 本月已收        │
│ RM15,000.00     │ RM3,000.00      │ RM8,000.00      │
└─────────────────┴─────────────────┴─────────────────┘
```

**说明：**
- **应收总额**：所有未收清账款的剩余金额总和
- **逾期金额**：所有逾期账款的剩余金额总和
- **本月已收**：本月所有收款记录的金额总和

### 使用流程

#### 1. 查看应收账款列表

**列表显示：**
- 客户名称
- 关联单据（发票号）
- 应收金额
- 已收金额
- 未收金额
- 到期日
- 状态
- 操作按钮

**示例：**
```
┌─────┬───────────┬──────────┬──────────┬──────────┬──────────┬────────┬────────┐
│客户 │关联单据   │应收金额  │已收金额  │未收金额  │到期日    │状态    │操作    │
├─────┼───────────┼──────────┼──────────┼──────────┼──────────┼────────┼────────┤
│张三 │INV...-001 │RM1000.00 │RM500.00  │RM500.00  │2024-10-20│部分收款│👁️ ➕   │
│李四 │INV...-005 │RM2000.00 │RM0.00    │RM2000.00 │2024-10-01│已逾期  │👁️ ➕   │
│王五 │INV...-010 │RM800.00  │RM800.00  │RM0.00    │2024-10-15│已收清  │👁️     │
└─────┴───────────┴──────────┴──────────┴──────────┴──────────┴────────┴────────┘
```

**逾期提示：**
```
到期日：2024-10-01
逾期 14 天  ← 红色显示
```

#### 2. 筛选账款

**筛选选项：**
- 全部
- 未收款
- 部分收款
- 已逾期
- 已收清

**操作：**
```
状态: [已逾期 ▼]  共 5 条应收账款
```

#### 3. 记录收款

**步骤：**

**3.1 点击 ➕ 收款按钮**

**3.2 填写收款信息**
```
┌───────────────────────────────────────┐
│ 收款                               ✕  │
├───────────────────────────────────────┤
│ 客户: 张三                            │
│ 单据编号: INV202410-001               │
│ 未收金额: RM500.00                    │
│                                       │
│ 收款金额 *                            │
│ [500.00]                              │
│                                       │
│ 付款方式 *                            │
│ [现金 ▼]                              │
│  - 现金                               │
│  - T&G                                │
│  - Public Bank                        │
│  - Hong Leong Bank                    │
│  - 支票                               │
│  - 银行转账                           │
│  - 其他                               │
│                                       │
│ 收款日期 *                            │
│ [2024-10-15]                          │
│                                       │
│ 参考号/交易号                         │
│ [TXN123456789]                        │
│                                       │
│ 备注                                  │
│ [客户通过转账付款]                    │
│                                       │
│              [取消]  [确认收款]       │
└───────────────────────────────────────┘
```

**字段说明：**

| 字段 | 必填 | 说明 |
|------|------|------|
| 收款金额 | ✅ | 不能超过未收金额 |
| 付款方式 | ✅ | 选择客户的付款方式 |
| 收款日期 | ✅ | 实际收到款项的日期 |
| 参考号 | ❌ | 现金付款不需要 |
| 备注 | ❌ | 其他补充说明 |

**3.3 确认收款**

**系统执行：**
1. ✅ 创建收款记录
2. ✅ 更新已收金额
3. ✅ 更新未收金额
4. ✅ 更新账款状态
5. ✅ 记录到操作日志

**成功提示：**
```
✅ 收款成功！已收 RM500.00
```

#### 4. 查看账款详情

**点击 👁️ 查看详情**

**详情页面显示：**
```
┌──────────────────────────────────────────────┐
│ 应收账款详情                              ✕  │
├──────────────────────────────────────────────┤
│ 客户: 张三                关联单据: INV...001│
│ 应收金额: RM1,000.00     已收金额: RM500.00  │
│ 未收金额: RM500.00       到期日: 2024-10-20  │
│ 状态: [部分收款]         创建: 2024-10-10    │
│                                              │
│ 备注: 客户分期付款                           │
│                                              │
│ ─────────── 收款记录 ───────────            │
│ │收款日期    │金额      │方式  │操作人│     │
│ │2024-10-12  │RM300.00  │现金  │小李  │     │
│ │2024-10-14  │RM200.00  │T&G   │小李  │     │
│                                              │
│                              [关闭]          │
└──────────────────────────────────────────────┘
```

---

## 💳 应付账款管理

### 页面路径
**业务管理 → 应付账款**

### 统计卡片

```
┌─────────────────┬─────────────────┬─────────────────┐
│ 应付总额        │ 逾期金额        │ 本月已付        │
│ RM20,000.00     │ RM5,000.00      │ RM12,000.00     │
└─────────────────┴─────────────────┴─────────────────┘
```

**说明：**
- **应付总额**：所有未付清账款的剩余金额总和
- **逾期金额**：所有逾期账款的剩余金额总和
- **本月已付**：本月所有付款记录的金额总和

### 使用流程

#### 1. 查看应付账款列表

**列表显示：**
- 供应商名称
- 关联单据（采购单号）
- 应付金额
- 已付金额
- 未付金额
- 到期日
- 状态
- 操作按钮

**示例：**
```
┌─────────┬───────────┬──────────┬──────────┬──────────┬──────────┬────────┬────────┐
│供应商   │关联单据   │应付金额  │已付金额  │未付金额  │到期日    │状态    │操作    │
├─────────┼───────────┼──────────┼──────────┼──────────┼──────────┼────────┼────────┤
│ABC书店  │PO...-001  │RM5000.00 │RM2000.00 │RM3000.00 │2024-10-25│部分付款│👁️ ➕   │
│XYZ出版  │PO...-003  │RM8000.00 │RM0.00    │RM8000.00 │2024-10-05│已逾期  │👁️ ➕   │
│好书供应 │PO...-005  │RM1500.00 │RM1500.00 │RM0.00    │2024-10-18│已付清  │👁️     │
└─────────┴───────────┴──────────┴──────────┴──────────┴──────────┴────────┴────────┘
```

#### 2. 记录付款

**步骤：**

**2.1 点击 ➕ 付款按钮**

**2.2 填写付款信息**
```
┌───────────────────────────────────────┐
│ 付款                               ✕  │
├───────────────────────────────────────┤
│ 供应商: ABC书店                       │
│ 单据编号: PO202410-001                │
│ 未付金额: RM3,000.00                  │
│                                       │
│ 付款金额 *                            │
│ [3000.00]                             │
│                                       │
│ 付款方式 *                            │
│ [银行转账 ▼]                          │
│  - 银行转账                           │
│  - 现金                               │
│  - T&G                                │
│  - Public Bank                        │
│  - Hong Leong Bank                    │
│  - 支票                               │
│  - 其他                               │
│                                       │
│ 付款日期 *                            │
│ [2024-10-15]                          │
│                                       │
│ 参考号/交易号                         │
│ [TRF987654321]                        │
│                                       │
│ 备注                                  │
│ [通过公司账户转账]                    │
│                                       │
│              [取消]  [确认付款]       │
└───────────────────────────────────────┘
```

**2.3 确认付款**

**系统执行：**
1. ✅ 创建付款记录
2. ✅ 更新已付金额
3. ✅ 更新未付金额
4. ✅ 更新账款状态
5. ✅ 记录到操作日志

**成功提示：**
```
✅ 付款成功！已付 RM3,000.00
```

---

## 🔐 权限控制

### 角色权限矩阵

#### 应收账款

| 功能 | 老板 | 经理 | 收银员 | 仓管员 | 员工 |
|------|------|------|--------|--------|------|
| 查看应收账款 | ✅ | ✅ | ✅ | ❌ | ❌ |
| 记录收款 | ✅ | ✅ | ✅ | ❌ | ❌ |

**说明：**
- **收银员**：可以查看和记录客户收款（前台业务）
- **仓管员**：不涉及客户收款业务

#### 应付账款

| 功能 | 老板 | 经理 | 收银员 | 仓管员 | 员工 |
|------|------|------|--------|--------|------|
| 查看应付账款 | ✅ | ✅ | ❌ | ✅ | ❌ |
| 记录付款 | ✅ | ✅ | ❌ | ✅ | ❌ |

**说明：**
- **仓管员**：负责供应商付款（采购相关）
- **收银员**：不涉及供应商付款业务

---

## 💡 实际应用场景

### 场景1：客户分期付款

```
情况：
客户购买RM5,000的商品，约定分3次付清

流程：
1. 开单时
   - 创建发票（总额RM5,000）
   - 自动生成应收账款
   - 状态：未收款
   - 到期日：30天后

2. 第一次收款（10天后）
   - 收款：RM2,000
   - 状态：未收款 → 部分收款
   - 剩余：RM3,000

3. 第二次收款（20天后）
   - 收款：RM2,000
   - 状态：部分收款（剩余RM1,000）

4. 第三次收款（28天后）
   - 收款：RM1,000
   - 状态：部分收款 → 已收清
   - 剩余：RM0

结果：
✅ 账款记录完整
✅ 每次收款都有凭证
✅ 自动追踪未收金额
```

### 场景2：逾期账款提醒

```
情况：
客户李四的账款已逾期14天

显示：
┌────────────────────────────────┐
│ 客户: 李四                     │
│ 未收金额: RM2,000.00           │
│ 到期日: 2024-10-01             │
│ 逾期 14 天  ← 红色醒目显示    │
│ 状态: [已逾期]                 │
└────────────────────────────────┘

操作建议：
1. 联系客户催款
2. 记录沟通情况到备注
3. 收款后更新记录
```

### 场景3：供应商付款管理

```
情况：
向ABC书店采购RM5,000的图书，账期30天

流程：
1. 采购入库时
   - 创建采购单（总额RM5,000）
   - 自动生成应付账款
   - 状态：未付款
   - 到期日：2024-11-15

2. 付款前检查
   - 查看应付账款列表
   - 确认到期日临近
   - 准备付款资料

3. 执行付款（到期日前3天）
   - 通过银行转账
   - 记录付款：RM5,000
   - 填写交易参考号
   - 状态：未付款 → 已付清

4. 财务对账
   - 查看付款记录
   - 核对银行流水
   - 归档凭证

结果：
✅ 按时付款，保持信用
✅ 付款记录清晰
✅ 便于财务对账
```

---

## 📊 账龄分析

### 什么是账龄？

**账龄 = 今天 - 账款创建日**

### 账龄分类

| 账龄 | 状态 | 风险等级 |
|------|------|----------|
| 0-30天 | 正常 | 低风险 ✅ |
| 31-60天 | 注意 | 中风险 ⚠️ |
| 61-90天 | 警告 | 高风险 ⚠️ |
| 90天以上 | 危险 | 极高风险 ⛔ |

### 应收账龄示例

```
本月应收账款账龄分析
──────────────────────

0-30天:   RM10,000 (50%)  ████████████▌
31-60天:  RM5,000  (25%)  ██████▎
61-90天:  RM3,000  (15%)  ███▊
90天以上: RM2,000  (10%)  ██▌

总计: RM20,000

⚠️ 建议：重点追收61天以上账款
```

---

## 🎨 界面展示

### 应收账款页面

```
┌────────────────────────────────────────────────────────────────┐
│ 💰 应收账款                                                     │
│ 管理客户欠款和收款记录                                          │
├────────────────────────────────────────────────────────────────┤
│ ┌───────────────┐ ┌───────────────┐ ┌───────────────┐        │
│ │ 应收总额      │ │ 逾期金额      │ │ 本月已收      │        │
│ │ RM15,000.00   │ │ RM3,000.00    │ │ RM8,000.00    │        │
│ │ 💵            │ │ ⚠️            │ │ 📈            │        │
│ └───────────────┘ └───────────────┘ └───────────────┘        │
├────────────────────────────────────────────────────────────────┤
│ 状态: [全部 ▼]  共 25 条应收账款                               │
├────────────────────────────────────────────────────────────────┤
│ [应收账款列表表格]                                              │
└────────────────────────────────────────────────────────────────┘
```

### 应付账款页面

```
┌────────────────────────────────────────────────────────────────┐
│ 💳 应付账款                                                     │
│ 管理供应商欠款和付款记录                                        │
├────────────────────────────────────────────────────────────────┤
│ ┌───────────────┐ ┌───────────────┐ ┌───────────────┐        │
│ │ 应付总额      │ │ 逾期金额      │ │ 本月已付      │        │
│ │ RM20,000.00   │ │ RM5,000.00    │ │ RM12,000.00   │        │
│ │ 🧾            │ │ ⚠️            │ │ 📉            │        │
│ └───────────────┘ └───────────────┘ └───────────────┘        │
├────────────────────────────────────────────────────────────────┤
│ 状态: [已逾期 ▼]  共 8 条应付账款                              │
├────────────────────────────────────────────────────────────────┤
│ [应付账款列表表格]                                              │
└────────────────────────────────────────────────────────────────┘
```

---

## ⚙️ 账款自动创建

### 触发条件

#### 应收账款自动创建
**当发生以下情况时：**
1. ✅ 创建发票（开单管理）
2. ✅ 创建销售订单（出货管理）

**自动生成应收账款：**
- 客户ID和名称
- 关联单据ID和编号
- 总金额
- 到期日（通常30天）
- 状态：pending

#### 应付账款自动创建
**当发生以下情况时：**
1. ✅ 创建采购订单（进货管理）

**自动生成应付账款：**
- 供应商ID和名称
- 关联单据ID和编号
- 总金额
- 到期日（根据账期设置）
- 状态：pending

---

## 📈 财务报表

### 应收账款汇总

```
应收账款汇总表
────────────────────────

总客户数：50
有欠款客户：25
应收账款总额：RM50,000.00

按状态分类：
- 未收款：RM20,000 (40%)
- 部分收款：RM15,000 (30%)
- 已逾期：RM10,000 (20%)
- 已收清：RM5,000 (10%)

前5大欠款客户：
1. 李四 - RM8,000
2. 王五 - RM6,000
3. 赵六 - RM5,000
4. 孙七 - RM4,000
5. 周八 - RM3,000
```

### 应付账款汇总

```
应付账款汇总表
────────────────────────

总供应商数：20
有欠款供应商：10
应付账款总额：RM80,000.00

按状态分类：
- 未付款：RM30,000 (37.5%)
- 部分付款：RM25,000 (31.25%)
- 已逾期：RM20,000 (25%)
- 已付清：RM5,000 (6.25%)

前5大应付供应商：
1. ABC书店 - RM15,000
2. XYZ出版 - RM12,000
3. 好书供应 - RM10,000
4. 教育图书 - RM8,000
5. 文化书局 - RM6,000
```

---

## 🚀 立即体验

系统正在运行：**http://localhost:3004/**

### 测试流程

#### 测试应收账款

1. **登录系统**
   ```
   用户名: admin
   密码: admin123
   ```

2. **创建发票（生成应收账款）**
   ```
   开单管理 → 新建发票
   → 选择客户
   → 添加商品
   → 提交（不立即付款或部分付款）
   → 自动生成应收账款
   ```

3. **查看应收账款**
   ```
   业务管理 → 应收账款
   → 看到刚才的账款记录
   → 状态：未收款或部分收款
   ```

4. **记录收款**
   ```
   点击 ➕ 收款
   → 输入收款金额
   → 选择付款方式
   → 确认收款
   → 查看状态变化
   ```

#### 测试应付账款

1. **创建采购单（生成应付账款）**
   ```
   交易管理 → 进货管理
   → 创建采购单
   → 选择供应商和商品
   → 提交
   → 自动生成应付账款
   ```

2. **查看应付账款**
   ```
   业务管理 → 应付账款
   → 看到刚才的账款记录
   ```

3. **记录付款**
   ```
   点击 ➕ 付款
   → 输入付款金额
   → 选择付款方式
   → 填写交易参考号
   → 确认付款
   ```

---

## ⚠️ 注意事项

### 1. 账款与原单据的关系

**重要：**
- ✅ 账款是独立的财务记录
- ✅ 不影响原单据（发票/采购单）
- ✅ 只追踪收付款情况

### 2. 收款/付款记录不可删除

**原因：**
- 财务记录需要完整性
- 审计追溯要求
- 防止财务数据篡改

**如果记录错误：**
- 可以添加备注说明
- 可以创建反向记录
- 联系管理员处理

### 3. 逾期账款管理

**建议操作：**
1. 每天查看逾期账款列表
2. 按逾期天数排序
3. 优先处理长期逾期账款
4. 记录催款情况到备注

### 4. 付款方式选择

**建议：**
- 大额付款：银行转账（有凭证）
- 小额收款：现金/T&G
- 必须填写参考号：便于对账

---

## 📊 数据完整性

### 关联关系

```
发票/销售单
    ↓ 自动创建
应收账款
    ↓ 记录
收款记录
    ↓ 更新
应收账款状态

采购单
    ↓ 自动创建
应付账款
    ↓ 记录
付款记录
    ↓ 更新
应付账款状态
```

### 数据追溯

**从账款 → 找到单据：**
- 查看关联单据编号
- 点击查看原始发票/采购单

**从单据 → 找到账款：**
- 在发票/采购单页面
- 查看相关账款信息

---

## 📝 总结

**账款管理系统已完整实现：**
- ✅ 应收账款管理
- ✅ 应付账款管理
- ✅ 收款/付款记录
- ✅ 逾期提醒
- ✅ 状态自动更新
- ✅ 统计分析
- ✅ 权限控制
- ✅ 操作日志

**业务价值：**
- 🎯 清晰追踪资金流
- 🎯 防止坏账损失
- 🎯 优化现金流管理
- 🎯 提高财务效率

**账款管理，让财务更清晰！** 💰✨

